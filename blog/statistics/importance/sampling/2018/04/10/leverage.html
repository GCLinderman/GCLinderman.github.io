<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Leverage Scores</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/~gcl22/blog/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/~gcl22/blog/statistics/importance/sampling/2018/04/10/leverage.html">
  <link rel="alternate" type="application/rss+xml" title="Aesculapian Mathematics" href="/~gcl22/blog/feed.xml">
  
  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <!---    <a class="site-title" rel="author" href="/~gcl22/blog/">Aesculapian Mathematics</a> --->

    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
            <a class="page-link" href="http://gauss.math.yale.edu/~gcl22/">Homepage</a>
		<!---
          
            
            
          
            
            
            <a class="page-link" href="/~gcl22/blog/about/">About</a>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
	  --->
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Leverage Scores</h1>
    <p class="post-meta">
      <time datetime="2018-04-10T10:58:45-04:00" itemprop="datePublished">
        
        Apr 10, 2018
      </time>
      </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <script type="text/javascript" src="https://livejs.com/live.js"></script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<link rel="stylesheet" href="/~gcl22/blog/assets/css/latex_macros.css" />

<style>

 summary::-webkit-details-marker {
 color: #000000;
 font-size: 125%;
 margin-right: 2px;
}
summary:focus {
	outline-style: none;
}
article > details > summary {
	font-size: 28px;
	margin-top: 16px;

}
summary{
	font-style: italic;
}
details > p {
	margin-left: 24px;
}
details details {
	margin-left: 36px;
}
details details summary {
	font-size: 16px;
}


</style>

<h2 id="leverage-scores">Leverage Scores</h2>
<p>Given a datamatrix $A \in \mathbb R^{m \times n}$. Let $a_i \in \mathbb R^n$ be the $i$th row of $A$.</p>

<script type="math/tex; mode=display">\min_x \|x\|_2 \text{ s.t. } a_i^T = x^T A</script>

<p>Note that given $U$, where the columns of $U$ are an orthonormal basis for the
column space of $A$, the $i$th leverage score is the L2 norm of the $i$th row of
this matrix. This can be easily seen as follows:</p>

<p>Compute the SVD of $A$ as $A = U S V^T$, then we have $x = a_i^T V S^{-1} U^T$, so</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}
\|x\|_2^2 &= x^T x\\
 &= a_i^TUS^{-1}U^T U S^{-1} V^Ta_i\\
 &= a_i^T VS^{-1}S^{-1} V^Ta_i\\
 &= u_i^TS S^{-1}S^{-1} S u_i \\
 &= \|u_i\|_2^2
\end{align*} %]]></script>

<p>Because $a_i^T V = u_i^T S$, where 
<script type="math/tex">U = \begin{bmatrix}u_1^T\\ u_2^T \\ \vdots \\ u_m^T \end{bmatrix}</script>
.</p>

<h2 id="experiments">Experiments</h2>
<h3 id="unequal-sized-balls">Unequal sized balls</h3>
<p>I wanted a simple example to understand how these scores work. So, I generated
10 well separated Gaussian balls of sizes: 100, 200, 300,…,1000. In this
case, I would like the sampling probability (i.e. the leverage score) to be
decreasing as the size of the balls increases. In other words, there should be
high probability of sampling from the small ball, and low probability of
sampling from the large ball.</p>

<p>When these balls are in 10 dimensions, this is exactly what we observe in the following MATLAB code:</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">rng</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="c1">% Make some well separated Gaussian balls. </span>
<span class="n">dim</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="n">num_of_balls</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="n">sigma_0</span> <span class="o">=</span> <span class="o">.</span><span class="mi">0002</span><span class="p">;</span>
<span class="n">X</span> <span class="o">=</span> <span class="p">[];</span>
<span class="k">for</span> <span class="nb">i</span> <span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">num_of_balls</span><span class="p">,</span>
    <span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="p">;</span> <span class="n">mvnrnd</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="nb">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">dim</span><span class="p">),</span> <span class="nb">diag</span><span class="p">(</span><span class="n">sigma_0</span><span class="o">*</span><span class="nb">ones</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span> <span class="nb">i</span><span class="o">*</span><span class="mi">100</span><span class="p">)];</span>
<span class="k">end</span>

<span class="c1">% Compute Leverage Scores</span>
<span class="p">[</span><span class="n">U</span> <span class="n">S</span> <span class="n">V</span><span class="p">]</span> <span class="o">=</span> <span class="nb">svd</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="n">taus</span> <span class="o">=</span>  <span class="nb">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">U</span><span class="o">.^</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>

<span class="nb">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">taus</span><span class="p">);</span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s1">'Leverage Score'</span><span class="p">)</span>

</code></pre></div></div>

<p><img src="/~gcl22/blog/assets/leverage/dim10i100.png" alt="dim10" />
So, on every ball, the leverage scores are very similar. Bigger balls have smaller leverage scores. This seems like a great way to sample.</p>

<p>However, when I increase the dimension (i.e. set dim=100 in the code), things don’t look as nice:</p>

<p><img src="/~gcl22/blog/assets/leverage/dim100i100.png" alt="dim100" /></p>

<p>I suppose this is just because every ball has outliers, and the leverage score
is large on those outliers. In some sense, every point is an outlier in high
dimensions. That being said, if my goal is to sample from the small clusters
with higher probability than the large clusters, it does not seem like I would
want to sample according to this score.</p>

<!-- 
### A single cluster
One final experiment I ran is to just look at one cluster in 2 dimensions, just to see what it looks like. Here are 1000 Gaussian distributed points in 2 dimensions, colored by their leverage scores:


![onecluster](/~gcl22/blog/assets/leverage/oneball.png)

It essentially chose a single "axis."  And it makes sense, the reddest points
are the ones that can't be written as an average of many others. But look at
the point in the upper right corner. I would have thought that this point is
pretty "outlier-like", but it got a very low leverage score.  Again, I can see why--it is easier to write as an average of its friends. 


-->


  </div>

  
</article>

      </div>
    </main>

    <footer class="site-footer h-card">
  <data class="u-url" href="/~gcl22/blog/"></data>

  <div class="wrapper">

	  <!-- <h2 class="footer-heading">Aesculapian Mathematics</h2> --->

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">
            
              George C. Linderman
            
            </li>
            
            <li><a class="u-email" href="mailto:george.linderman[at]yale.edu">george.linderman[at]yale.edu</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          

          
          <li>
            <a href="https://twitter.com/gclinderman"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">gclinderman</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
